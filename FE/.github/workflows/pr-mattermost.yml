name: PR Notification to Mattermost

on:
  pull_request:
    types: [opened, reopened, closed]

jobs:
  notify-mattermost:
    runs-on: ubuntu-latest
    steps:
      - name: Set PR Status Message and Send Notification
        run: |

          STATUS=""
          COLOR=""

          case "${{ github.event.action }}" in
            "opened")
              STATUS=":manggom_1:  **ìƒˆë¡œìš´ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!** :manggom_1: "
              COLOR="#36a64f"
              ;;
            "reopened")
              STATUS=":duck_dance: **PRì´ ë‹¤ì‹œ ì—´ë ¸ìŠµë‹ˆë‹¤!** :duck_dance: "
              COLOR="#ffcc00"
              ;;
            "closed")
              if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
                STATUS=":kirby_shake:  **PRì´ ë¨¸ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!** :kirby_shake: "
                COLOR="#0000ff"
              else
                STATUS=":sad-shin-chang:  **PRì´ ë‹«í˜”ìŠµë‹ˆë‹¤.** :sad-shin-chang: "
                COLOR="#ff0000"
              fi
              ;;
          esac


          if [ -z "${{ secrets.MATTERMOST_WEBHOOK }}" ]; then
            echo "âŒ Webhook URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            exit 1
          fi

          curl -X POST -H 'Content-Type: application/json' \
            -d @- ${{ secrets.MATTERMOST_WEBHOOK }} <<EOF
          {
            "attachments": [{
              "color": "$COLOR",
              "title": "$STATUS",
              "text": "ğŸ“Œ *ì œëª©:*  **${{ github.event.pull_request.title }}**  \n\nğŸ‘¤ *ì‘ì„±ì:*  **${{ github.event.pull_request.user.login }}**  \n\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})",
              "footer": "ğŸ˜º Approve í•„ìˆ˜! ğŸ˜º ",
              "ts": $(date +%s)
            }]
          }
          EOF


